

é©¬è‹±æ‰Â è…¾è®¯æŠ€æœ¯å·¥ç¨‹

Â _2024å¹´03æœˆ19æ—¥ 18:02_Â _å¹¿ä¸œ_

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_gif/j3gficicyOvasIjZpiaTNIPReJVWEJf7UGpmokI3LL4NbQDb8fO48fYROmYPXUhXFN8IdDqPcI1gA6OfSLsQHxB4w/640?wx_fmt=gif&wxfrom=13&tp=wxpic)

  

![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/j3gficicyOvauCTKmIUakdm23FkH2QA8wNyhWQkhLdrEXxOJslKicflGTqKdANHNXOcibGhcJ5fWVic0UbTNNhFJ3Vw/640?wx_fmt=png&wxfrom=13)

  

å¯¼è¯­ï¼šæœ¬æ–‡è¯¦ç»†ä»‹ç»äº† ElasticSearch å¦‚æœç´¢æ€§èƒ½æŒ‡æ ‡ã€ç´¢å¼•æ€§èƒ½æŒ‡æ ‡ã€å†…å­˜ä½¿ç”¨å’Œåƒåœ¾å›æ”¶æŒ‡æ ‡ç­‰å…­ç±»ç›‘æ§å…³é”®æŒ‡æ ‡ã€é›†ç¾¤å’Œç´¢å¼•ä¸¤ç±»å¤§ç›˜é…ç½®ç¤ºä¾‹ï¼Œä»¥åŠ ES åœ¨æŸ¥è¯¢æ€§èƒ½å·®ã€ç´¢å¼•æ€§èƒ½å·®çš„ä¸¤ç§å…¸å‹é—®é¢˜åœºæ™¯ä¸‹è¯¦ç»†çš„åŸå› ã€æ’æŸ¥æ–¹å¼å’Œè§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶ä¹Ÿä»‹ç»äº†å¦‚ä½•é€šè¿‡ Prometheus ç›‘æ§æ­å»ºå¯é çš„ç›‘æ§ç³»ç»Ÿï¼Œè¯¦å°½å…¨é¢ï¼Œæ¨èç»™å¤§å®¶ï¼Œä¹Ÿæ¬¢è¿å„ä½ä¸€èµ·äº¤æµã€‚

  

  

Â **1. ElasticSearch ç®€ä»‹**

1.1 æ¦‚è¦

ElasticSearch ï¼ˆç®€ç§°ESï¼‰æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€å…è´¹ã€å¼€æ”¾çš„æœç´¢å’Œåˆ†æå¼•æ“ï¼Œé€‚ç”¨äºæ‰€æœ‰ç±»å‹çš„æ•°æ®ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€æ•°å­—ã€åœ°ç†ç©ºé—´ã€ç»“æ„åŒ–å’Œéç»“æ„åŒ–æ•°æ®ï¼Œæœ€åˆç”± Elastic å¼€å‘å¹¶å¼€æºã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œåº•å±‚åŸºäº Lucene å®ç°ã€‚ElasticSearch å±è”½äº† Lucene çš„åº•å±‚ç»†èŠ‚ï¼Œæä¾›äº†åˆ†å¸ƒå¼ç‰¹æ€§ï¼ŒåŒæ—¶å¯¹å¤–æä¾›äº† Restful APIã€‚ElasticSearch ä»¥å…¶æ˜“ç”¨æ€§è¿…é€Ÿèµ¢å¾—äº†è®¸å¤šç”¨æˆ·ï¼Œè¢«ç”¨åœ¨ç½‘ç«™æœç´¢ã€æ—¥å¿—åˆ†æç­‰è¯¸å¤šæ–¹é¢ã€‚ç”±äº ES å¼ºå¤§çš„æ¨ªå‘æ‰©å±•èƒ½åŠ›ï¼Œç”šè‡³å¾ˆå¤šäººä¹Ÿä¼šç›´æ¥æŠŠ ES å½“åš NoSQL æ¥ç”¨ã€‚

1.2 ç‰¹ç‚¹

- **å®æ—¶æ€§**ï¼šElasticSearch èƒ½å¤Ÿå®æ—¶åœ°å­˜å‚¨ã€æ£€ç´¢å’Œåˆ†ææ•°æ®ï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿè·å¾—æœ€æ–°çš„æœç´¢ç»“æœå’Œåˆ†ææ•°æ®ï¼›
    
      
    
- **åˆ†å¸ƒå¼**ï¼šElasticSearch é‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„ï¼Œèƒ½å¤Ÿæ°´å¹³æ‰©å±•ï¼Œå¤„ç† PB çº§ç»“æ„åŒ–æˆ–éç»“æ„åŒ–æ•°æ®ï¼ŒåŒæ—¶å…·æœ‰é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ï¼›
    
      
    
- **å¤šæ ·åŒ–çš„æœç´¢å’Œåˆ†æåŠŸèƒ½**ï¼šElasticSearch æ”¯æŒå…¨æ–‡æœç´¢ã€ç»“æ„åŒ–æŸ¥è¯¢ã€è¿‡æ»¤ã€åœ°ç†ç©ºé—´æŸ¥è¯¢å’Œå¤æ‚çš„åˆ†æåŠŸèƒ½ï¼›
    
      
    
- **å¯æ‰©å±•æ€§**ï¼šElasticSearch æä¾›äº†ä¸°å¯Œçš„æ’ä»¶å’Œ APIï¼Œå¯ä»¥è½»æ¾åœ°æ‰©å±•å…¶åŠŸèƒ½ã€‚
    

1.3 åŸºæœ¬æ¦‚å¿µ

### **_èŠ‚ç‚¹ï¼ˆNodeï¼‰_**

ElasticSearch æ˜¯ä»¥é›†ç¾¤çš„æ–¹å¼è¿è¡Œçš„ï¼Œè€ŒèŠ‚ç‚¹æ˜¯ç»„æˆ ES é›†ç¾¤çš„åŸºæœ¬å•ä½ï¼Œæ‰€ä»¥æ¯ä¸ª ElasticSearch å®ä¾‹å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªç‰©ç†æœºå™¨ä¸Šå¯ä»¥æœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œä½¿ç”¨ä¸åŒçš„ç«¯å£å’ŒèŠ‚ç‚¹åç§°ã€‚

  
**èŠ‚ç‚¹æŒ‰ä¸»è¦åŠŸèƒ½å¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼šä¸»èŠ‚ç‚¹(Master Node)ï¼Œåè°ƒèŠ‚ç‚¹(Coordianting Node)å’Œæ•°æ®èŠ‚ç‚¹(Data Node)ã€‚**

  

- **ä¸»èŠ‚ç‚¹**ï¼šå¤„ç†åˆ›å»ºï¼Œåˆ é™¤ç´¢å¼•ç­‰è¯·æ±‚ï¼Œç»´æŠ¤é›†ç¾¤çŠ¶æ€ä¿¡æ¯ã€‚å¯ä»¥è®¾ç½®ä¸€ä¸ªèŠ‚ç‚¹ä¸æ‰¿æ‹…ä¸»èŠ‚ç‚¹è§’è‰²ï¼›
    
      
    
- **åè°ƒèŠ‚ç‚¹**ï¼šè´Ÿè´£å¤„ç†è¯·æ±‚ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ˜¯åè°ƒèŠ‚ç‚¹ï¼›
    
      
    
- **æ•°æ®èŠ‚ç‚¹**ï¼šç”¨æ¥ä¿å­˜æ•°æ®ã€‚å¯ä»¥è®¾ç½®ä¸€ä¸ªèŠ‚ç‚¹ä¸æ‰¿æ‹…æ•°æ®èŠ‚ç‚¹è§’è‰²ã€‚
    

### **_é›†ç¾¤ï¼ˆClusterï¼‰_**

ElasticSearchÂ æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æœç´¢å¼•æ“ï¼Œæ‰€ä»¥ä¸€èˆ¬ç”±å¤šå°ç‰©ç†æœºç»„æˆã€‚è€Œåœ¨è¿™äº›æœºå™¨ä¸Šé€šè¿‡é…ç½®ä¸€ä¸ªç›¸åŒçš„ cluster nameï¼Œå¯ä»¥è®©å…¶äº’ç›¸å‘ç°ä»è€ŒæŠŠè‡ªå·±ç»„ç»‡æˆä¸€ä¸ªé›†ç¾¤ã€‚

### **_åˆ†ç‰‡ & å‰¯æœ¬ï¼ˆShards & Replicasï¼‰_**

ç´¢å¼•å¯ä»¥å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œå¯èƒ½ä¼šè¶…è¿‡å•ä¸ªèŠ‚ç‚¹çš„ç¡¬ä»¶é™åˆ¶ï¼Œè€Œä¸”ä¼šå¯¼è‡´å•ä¸ªèŠ‚ç‚¹æ•ˆç‡é—®é¢˜ã€‚ES æä¾›äº†å°†å•ä¸ª Index æ‹†åˆ†åˆ°å¤šä¸ª Shard ä¸Šçš„èƒ½åŠ›ï¼Œå¯ä»¥æ”¯æŒæ°´å¹³æ‰©å±•ï¼Œåˆ†å¸ƒå¼å’Œå¹¶è¡Œè·¨ Shard æ“ä½œï¼ˆå¯èƒ½åœ¨å¤šä¸ªèŠ‚ç‚¹ï¼‰ï¼Œä»è€Œæé«˜äº†æ€§èƒ½å’Œååé‡ã€‚

  
ä¸ºäº†é¿å…æ•…éšœå¯¼è‡´èŠ‚ç‚¹åŠåˆ†ç‰‡å‡ºç°é—®é¢˜ï¼ŒES å¯ä»¥ä¸ºåˆ†ç‰‡è®¾ç½®å‰¯æœ¬ï¼ˆReplicasï¼‰ï¼Œå‰¯æœ¬é€šå¸¸åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œä¿è¯é«˜å¯ç”¨æ€§ã€‚

### **_Index (ç´¢å¼•)_**

Index(ç´¢å¼•) æ˜¯å…·æœ‰ç¨å¾®ç±»ä¼¼ç‰¹å¾æ–‡æ¡£çš„é›†åˆï¼ŒåŒåœ¨ä¸€ä¸ªç´¢å¼•ä¸­çš„æ–‡æ¡£å…±åŒå»ºç«‹å€’æ’ç´¢å¼•ã€‚ç±»ä¼¼äº MySQL ä¸­çš„ database æ¦‚å¿µï¼Œä½† ES ä¸­çš„ Index æ›´åŠ çµæ´»ï¼Œç”¨èµ·æ¥ä¹Ÿæ›´åŠ æ–¹ä¾¿ã€‚æäº¤ç»™åŒä¸€ä¸ªç´¢å¼•ä¸­çš„æ–‡æ¡£ï¼Œæœ€å¥½æ‹¥æœ‰ç›¸åŒçš„ç»“æ„ã€‚è¿™æ ·å¯¹äº ES æ¥è¯´ï¼Œä¸ç®¡æ˜¯å­˜å‚¨è¿˜æ˜¯æŸ¥è¯¢ï¼Œéƒ½æ›´å®¹æ˜“ä¼˜åŒ–ã€‚

### **_ç±»å‹ï¼ˆTypeï¼‰_**

Document çš„ç±»å‹ï¼Œç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨çš„æ¦‚å¿µã€‚è¯¥æ¦‚å¿µåœ¨6.X æ—¶è¿˜å¯ä»¥ä½¿ç”¨ï¼Œä½†åœ¨ Type çš„æ¦‚å¿µå·²åœ¨7.X å¼€å§‹åºŸå¼ƒï¼Œå®˜æ–¹è®¤ä¸ºè¿™æ˜¯ä¸ªé”™è¯¯çš„è®¾è®¡ã€‚

### **_Document (æ–‡æ¡£)_**

æ–‡æ¡£æ˜¯ ES ç´¢å¼•çš„åŸºæœ¬å•ä½ï¼Œæ¯ä¸ªç´¢å¼•éƒ½æ˜¯ç”±æ•°é‡ä¼—å¤šçš„æ–‡æ¡£ç»„æˆï¼ŒDocument ç›¸å½“äºä¼ ç»Ÿæ•°æ®åº“ä¸­çš„è¡Œï¼ŒES ä¸­æ•°æ®ä»¥ JSON çš„å½¢å¼æ¥è¡¨ç¤ºã€‚

### **_å­—æ®µï¼ˆFieldsï¼‰_**

æ¯ä¸ª Document éƒ½ç±»ä¼¼ä¸€ä¸ª JSON ç»“æ„ï¼Œå®ƒåŒ…å«äº†è®¸å¤šå­—æ®µï¼Œæ¯ä¸ªå­—æ®µéƒ½æœ‰å…¶å¯¹åº”çš„å€¼ï¼Œå¤šä¸ªå­—æ®µç»„æˆäº†ä¸€ä¸ª Documentï¼Œå¯ä»¥ç±»æ¯”å…³ç³»å‹æ•°æ®åº“æ•°æ®è¡¨ä¸­çš„å­—æ®µã€‚

### **_æ˜ å°„ï¼ˆmappingï¼‰_**

ç›¸å½“äºæ•°æ®åº“ä¸­çš„ schemaï¼Œç”¨æ¥çº¦æŸå­—æ®µçš„æ•°æ®ç±»å‹ï¼Œæ¯ä¸€ç§æ•°æ®ç±»å‹éƒ½æœ‰å¯¹åº”çš„ä½¿ç”¨åœºæ™¯ã€‚mapping ä¸­å®šä¹‰äº†ä¸€ä¸ªæ–‡æ¡£æ‰€åŒ…å«çš„æ‰€æœ‰ field ä¿¡æ¯ï¼Œæ¯ä¸ªæ–‡æ¡£éƒ½æœ‰æ˜ å°„ã€‚mapping ä¸æ˜¯å¿…é¡»åˆ›å»ºï¼Œå› ä¸º ES ä¸­å®ç°äº†åŠ¨æ€æ˜ å°„ã€‚

### **ç¤ºä¾‹**

æ·»åŠ  Index members çš„ mappingï¼š

  

```
PUT members
```

  

åœ¨ Index members ä¸­æ·»åŠ ä¸€ä¸ª Documentï¼š

  

`PUT members/_doc/10086``{` Â  Â `"id": 10086,` Â  Â `"name": "æ³•å¤–ç‹‚å¾’å¼ ä¸‰",` Â  Â `"birthday": "1990-10-24T09:00:00Z"``}`

  

  

1.4Â åŸºæœ¬æ¦‚å¿µ

  

- **æœç´¢å¼•æ“**ï¼šåœ¨ç½‘ç«™ã€åº”ç”¨æˆ–æ–‡æ¡£å­˜å‚¨ä¸­æä¾›å…¨æ–‡æœç´¢åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç”µå­å•†åŠ¡ç½‘ç«™ä½¿ç”¨ ElasticSearch æ¥è®©ç”¨æˆ·å¿«é€Ÿæœç´¢äº§å“ï¼›
    
      
    
- **æ—¥å¿—å’ŒæŒ‡æ ‡åˆ†æ**ï¼šç”¨äºæ”¶é›†ã€å­˜å‚¨å’Œåˆ†ææ—¥å¿—ä»¥åŠæŒ‡æ ‡æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç½‘ç»œåº”ç”¨ç¨‹åºä½¿ç”¨ ElasticSearch æ¥å­˜å‚¨å’Œåˆ†æå…¶æ—¥å¿—æ–‡ä»¶ï¼Œä»¥ä¾¿ç›‘æ§æ€§èƒ½å’Œæ’æŸ¥é—®é¢˜ï¼›
    
      
    
- **å®æ—¶æ•°æ®åˆ†æ**ï¼šç”¨äºå®æ—¶åˆ†æå’Œå¯è§†åŒ–å¤§è§„æ¨¡çš„å®æ—¶æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªé‡‘èæœºæ„ä½¿ç”¨ ElasticSearch æ¥ç›‘æ§äº¤æ˜“æ•°æ®å’Œå®æ—¶å¸‚åœºåŠ¨æ€ï¼›
    
      
    
- **å†…å®¹æ¨è**ï¼šç”¨äºæ ¹æ®ç”¨æˆ·åå¥½å’Œè¡Œä¸ºæä¾›ä¸ªæ€§åŒ–çš„å†…å®¹æ¨èã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ–°é—»ç½‘ç«™ä½¿ç”¨ ElasticSearch æ¥æ¨èç›¸å…³æ–°é—»æ–‡ç« ç»™ç”¨æˆ·ï¼›
    
      
    
- **ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§**ï¼šç”¨äºè·Ÿè¸ªå’Œç›‘æ§ä¸šåŠ¡æŒ‡æ ‡ä»¥æ”¯æŒå†³ç­–ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä¼ä¸šä½¿ç”¨ ElasticSearch æ¥ç›‘æ§é”€å”®æ•°æ®å’Œåº“å­˜æƒ…å†µã€‚
    

  

**2. ç›‘æ§å…³é”®æŒ‡æ ‡**

  

ElasticSearchÂ æä¾›äº†å¤§é‡çš„æŒ‡æ ‡ï¼Œå¯ä»¥ç”¨äºç›‘æ§å„ç±»æ•…éšœç°è±¡ï¼š

  

- æœç´¢æ€§èƒ½æŒ‡æ ‡
    
      
    
- ç´¢å¼•æ€§èƒ½æŒ‡æ ‡
    
      
    
- å†…å­˜ä½¿ç”¨å’Œåƒåœ¾å›æ”¶æŒ‡æ ‡
    
      
    
- ä¸»æœºçº§åˆ«ç½‘ç»œç³»ç»ŸæŒ‡æ ‡
    
      
    
- é›†ç¾¤å¥åº·å’ŒèŠ‚ç‚¹å¯ç”¨æ€§æŒ‡æ ‡
    
      
    
- èµ„æºé¥±å’Œåº¦å’Œé”™è¯¯
    

  

2.1 æœç´¢æ€§èƒ½æŒ‡æ ‡

**_ES æŸ¥è¯¢æµç¨‹ä»‹ç»_**  

Â **ES æŸ¥è¯¢å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š**

  

- æ ¹æ® ID æŸ¥è¯¢ Docï¼Œå¯å®æ—¶æ£€ç´¢å†™å…¥çš„æ•°æ®ã€‚æ£€ç´¢æµç¨‹ï¼šæ£€ç´¢å†…å­˜ä¸­ Translog â†’ æ£€ç´¢ç£ç›˜ Translog â†’ æ£€ç´¢ç£ç›˜ Segmentï¼›
    
      
    

- æ ¹æ® query æŸ¥è¯¢ Docï¼Œè¿‘å®æ—¶æ£€ç´¢å†™å…¥çš„æ•°æ®ã€‚æ£€ç´¢æµç¨‹ï¼šæ£€ç´¢ filesystem cacheä¸­ segmnet â†’ æ£€ç´¢ç£ç›˜ Segmentã€‚
    
      
    

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

  

**æ£€ç´¢ç­–ç•¥å¯åˆ†ä¸ºä¸‰å¤§ç±»ï¼š**

  

**QUERY_AND_FETCH**ï¼šæŸ¥è¯¢å®Œå°±è¿”å›æ•´ä¸ª Doc å†…å®¹ï¼Œå¯¹åº”æ ¹æ® ID æŸ¥è¯¢ Docï¼›

  

**QUERY_THEN_FETCH**ï¼šå…ˆæŸ¥è¯¢å‡ºå¯¹åº”çš„ Doc id ï¼Œç„¶åå†æ ¹æ® Doc id åŒ¹é…å»å¯¹åº”çš„æ–‡æ¡£ï¼›

  

**DFS_QUERY_THEN_FETCH**ï¼šåœ¨ QUERY_THEN_FETCH çš„åŸºç¡€ä¸Šå¤šäº†ç®—åˆ†ç¯èŠ‚ã€‚

  

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼ŒæŸ¥è¯¢é€šå¸¸åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼Œä»¥ QUERY_THEN_FETCH ä¸ºä¾‹å­ï¼š

  

**Query é˜¶æ®µï¼š**

  

1. å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª search è¯·æ±‚åˆ° NODE 3 ï¼Œ NODE 3 ä¼šåˆ›å»ºä¸€ä¸ªå¤§å°ä¸º from + size çš„ç©ºä¼˜å…ˆé˜Ÿåˆ—ï¼›
    
      
    
2. Node 3 å°†æŸ¥è¯¢è¯·æ±‚è½¬å‘åˆ°ç´¢å¼•çš„æ¯ä¸ªä¸»åˆ†ç‰‡æˆ–å‰¯æœ¬åˆ†ç‰‡ä¸­ã€‚æ¯ä¸ªåˆ†ç‰‡åœ¨æœ¬åœ°æ‰§è¡ŒæŸ¥è¯¢å¹¶æ·»åŠ ç»“æœåˆ°å¤§å°ä¸º from + size çš„æœ¬åœ°æœ‰åºä¼˜å…ˆé˜Ÿåˆ—ä¸­ï¼›
    
      
    
3. æ¯ä¸ªåˆ†ç‰‡è¿”å›å„è‡ªä¼˜å…ˆé˜Ÿåˆ—ä¸­æ‰€æœ‰æ–‡æ¡£çš„ ID å’Œæ’åºå€¼ç»™åè°ƒèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ NODE 3 ï¼Œå®ƒåˆå¹¶è¿™äº›å€¼åˆ°è‡ªå·±çš„ä¼˜å…ˆé˜Ÿåˆ—ä¸­æ¥äº§ç”Ÿä¸€ä¸ªå…¨å±€æ’åºåçš„ç»“æœåˆ—è¡¨ã€‚
    
      
    
    ![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)
    

**Fetch é˜¶æ®µï¼š**

  

1. åè°ƒèŠ‚ç‚¹è¾¨åˆ«å‡ºå“ªäº›æ–‡æ¡£éœ€è¦è¢«å–å›å¹¶å‘ç›¸å…³çš„åˆ†ç‰‡æäº¤å¤šä¸ª GET è¯·æ±‚ï¼›
    
      
    
2. æ¯ä¸ªåˆ†ç‰‡åŠ è½½å¹¶ä¸°å¯Œæ–‡æ¡£ï¼Œå¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œæ¥ç€è¿”å›æ–‡æ¡£ç»™åè°ƒèŠ‚ç‚¹ï¼›
    
      
    
3. ä¸€æ—¦æ‰€æœ‰çš„æ–‡æ¡£éƒ½è¢«å–å›äº†ï¼Œåè°ƒèŠ‚ç‚¹è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚
    
      
    
    ![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)
    
      
    

**_ç›¸å…³æŒ‡æ ‡_**

|åºå·|æŒ‡æ ‡|ç±»å‹|è¯¦æƒ…|
|---|---|---|---|
|1|elasticsearch_indices_search_query_total|counter|æŸ¥è¯¢æ€»æ•° ååé‡|
|2|elasticsearch_indices_search_query_time_seconds|counter|æŸ¥è¯¢æ€»æ—¶é—´ æ€§èƒ½|
|3|elasticsearch_indices_search_fetch_total|counter|æå–æ€»æ•°|
|4|elasticsearch_indices_search_fetch_time_seconds|counter|èŠ±è´¹åœ¨æå–ä¸Šçš„æ€»æ—¶é—´|
|5|elasticsearch_indices_get_time_seconds|counter|GETè¯·æ±‚æ€»æ—¶é—´|
|6|elasticsearch_indices_get_missing_total|counter|ä¸¢å¤±çš„æ–‡ä»¶çš„GETè¯·æ±‚æ€»æ•°|
|7|elasticsearch_indices_get_missing_time_seconds|counter|èŠ±è´¹åœ¨æ–‡æ¡£ä¸¢å¤±çš„GETè¯·æ±‚ä¸Šçš„æ€»æ—¶é—´|
|8|elasticsearch_indices_get_exists_time_seconds|counter|èŠ±è´¹åœ¨æ–‡æ¡£å­˜åœ¨çš„GETè¯·æ±‚ä¸Šçš„æ€»æ—¶é—´|
|9|elasticsearch_indices_get_exists_total|counter|å­˜åœ¨çš„æ–‡ä»¶çš„GETè¯·æ±‚æ€»æ•°|
|10|elasticsearch_indices_get_total|counter|GETè¯·æ±‚æ€»æ¬¡æ•°|

2.2 ç´¢å¼•æ€§èƒ½æŒ‡æ ‡

### **_ES å†™å…¥æµç¨‹ä»‹ç»  
_**

ES çš„ä»»æ„èŠ‚ç‚¹éƒ½å¯ä»¥ä½œä¸ºåè°ƒèŠ‚ç‚¹(coordinating node)æ¥å—è¯·æ±‚ï¼Œå½“åè°ƒèŠ‚ç‚¹æ¥å—åˆ°è¯·æ±‚åè¿›è¡Œä¸€ç³»åˆ—å¤„ç†ï¼Œç„¶åé€šè¿‡_routing å­—æ®µæ‰¾åˆ°å¯¹åº”çš„ primary shardï¼Œå¹¶å°†è¯·æ±‚è½¬å‘ç»™ primary shard, primary shard å®Œæˆå†™å…¥åï¼Œå°†å†™å…¥å¹¶å‘å‘é€ç»™å„ replicaï¼Œ raplica æ‰§è¡Œå†™å…¥æ“ä½œåè¿”å›ç»™ primary shardï¼Œ primary shard å†å°†è¯·æ±‚è¿”å›ç»™åè°ƒèŠ‚ç‚¹ã€‚å¤§è‡´æµç¨‹å¦‚ä¸‹å›¾ï¼š  

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

æ•´ä½“å†™å…¥æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š  

  

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

**_è¯´æ˜_**

**è¿‘å®æ—¶æ€§-refresh æ“ä½œ**ï¼šå½“ä¸€ä¸ªæ–‡æ¡£å†™å…¥ Lucene åæ˜¯ä¸èƒ½è¢«ç«‹å³æŸ¥è¯¢åˆ°çš„ï¼ŒElasticSearch æä¾›äº†ä¸€ä¸ª refresh æ“ä½œï¼Œä¼šå®šæ—¶åœ°è°ƒç”¨ Lucene çš„ reopen (æ–°ç‰ˆæœ¬ä¸º openIfChanged)ä¸ºå†…å­˜ä¸­æ–°å†™å…¥çš„æ•°æ®ç”Ÿæˆä¸€ä¸ªæ–°çš„ Segmentï¼Œæ­¤æ—¶è¢«å¤„ç†çš„æ–‡æ¡£å‡å¯ä»¥è¢«æ£€ç´¢åˆ°ã€‚refresh æ“ä½œçš„æ—¶é—´é—´éš”ç”± refresh_interval å‚æ•°æ§åˆ¶ï¼Œé»˜è®¤ä¸º1s, å½“ç„¶è¿˜å¯ä»¥åœ¨å†™å…¥è¯·æ±‚ä¸­å¸¦ä¸Š refresh è¡¨ç¤ºå†™å…¥åç«‹å³ refreshï¼Œå¦å¤–è¿˜å¯ä»¥è°ƒç”¨ refresh API æ˜¾å¼ refreshã€‚

  
**merge æ“ä½œ**ï¼šç”±äº refresh é»˜è®¤é—´éš”ä¸º1sï¼Œå› æ­¤ä¼šäº§ç”Ÿå¤§é‡çš„å° Segmentï¼Œä¸ºæ­¤ ES ä¼šè¿è¡Œä¸€ä¸ªä»»åŠ¡æ£€æµ‹å½“å‰ç£ç›˜ä¸­çš„ Segmentï¼Œå¯¹ç¬¦åˆæ¡ä»¶çš„ Segment è¿›è¡Œåˆå¹¶æ“ä½œï¼Œå‡å°‘ Lucene ä¸­çš„ Segment ä¸ªæ•°ï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œé™ä½è´Ÿè½½ã€‚ä¸ä»…å¦‚æ­¤ï¼Œmerge è¿‡ç¨‹ä¹Ÿæ˜¯æ–‡æ¡£åˆ é™¤å’Œæ›´æ–°æ“ä½œåï¼Œæ—§çš„ Doc çœŸæ­£è¢«åˆ é™¤çš„æ—¶å€™ã€‚ç”¨æˆ·è¿˜å¯ä»¥æ‰‹åŠ¨è°ƒç”¨ _forcemerge API æ¥ä¸»åŠ¨è§¦å‘ mergeï¼Œä»¥å‡å°‘é›†ç¾¤çš„ Segment ä¸ªæ•°å’Œæ¸…ç†å·²åˆ é™¤æˆ–æ›´æ–°çš„æ–‡æ¡£ã€‚

  

**Translog**ï¼šå½“ä¸€ä¸ªæ–‡æ¡£å†™å…¥ Lucence åæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œå³ä½¿æ‰§è¡Œäº† refresh æ“ä½œä»ç„¶æ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä¸­ï¼Œå¦‚æœæ­¤æ—¶æœåŠ¡å™¨å®•æœºï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†æ•°æ®å°†ä¼šä¸¢å¤±ã€‚ä¸ºæ­¤ ES å¢åŠ äº† Translogã€‚

  

å½“è¿›è¡Œæ–‡æ¡£å†™æ“ä½œæ—¶ä¼šå…ˆå°†æ–‡æ¡£å†™å…¥ Luceneï¼Œç„¶åå†™å…¥ä¸€ä»½åˆ° Translogï¼Œå†™å…¥ Translog æ˜¯è½ç›˜çš„(å¦‚æœå¯¹å¯é æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œä¹Ÿå¯ä»¥è®¾ç½®å¼‚æ­¥è½ç›˜ï¼Œå¯ä»¥æé«˜æ€§èƒ½ï¼Œç”±é…ç½® index.Translog.durability å’Œ index.Translog.sync_intervalæ§åˆ¶)ï¼Œè¿™æ ·å°±å¯ä»¥é˜²æ­¢æœåŠ¡å™¨å®•æœºåæ•°æ®çš„ä¸¢å¤±ã€‚ç”±äº Translog æ˜¯è¿½åŠ å†™å…¥ï¼Œå› æ­¤æ€§èƒ½æ¯”è¾ƒå¥½ã€‚ä¸ä¼ ç»Ÿçš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸åŒï¼Œè¿™é‡Œæ˜¯å…ˆå†™å…¥ Lucene å†å†™å…¥ Translogï¼ŒåŸå› æ˜¯å†™å…¥ Lucene å¯èƒ½ä¼šå¤±è´¥ï¼Œä¸ºäº†å‡å°‘å†™å…¥å¤±è´¥å›æ»šçš„å¤æ‚åº¦ï¼Œå› æ­¤å…ˆå†™å…¥ Luceneã€‚

  
**flush æ“ä½œ**ï¼šæ¯30åˆ†é’Ÿæˆ–å½“Translog è¾¾åˆ°ä¸€å®šå¤§å°(ç”±index.Translog.flush_threshold_size æ§åˆ¶ï¼Œé»˜è®¤512mb), ES ä¼šè§¦å‘ä¸€æ¬¡ flush æ“ä½œï¼Œæ­¤æ—¶ ES ä¼šå…ˆæ‰§è¡Œ refresh æ“ä½œå°† buffer ä¸­çš„æ•°æ®ç”Ÿæˆ Segmentï¼Œç„¶åè°ƒç”¨ Lucene çš„ commit æ–¹æ³•å°†æ‰€æœ‰å†…å­˜ä¸­çš„ Segment fsync åˆ°ç£ç›˜ã€‚æ­¤æ—¶ Lucene ä¸­çš„æ•°æ®å°±å®Œæˆäº†æŒä¹…åŒ–ï¼Œä¼šæ¸…ç©º Translog ä¸­çš„æ•°æ®(6.xç‰ˆæœ¬ä¸ºäº†å®ç° sequenceIDsï¼Œä¸åˆ é™¤ Translog)ã€‚

### **_ç›¸å…³æŒ‡æ ‡_**

æ ¹æ®ä¸Šè¿°æµç¨‹å¯çŸ¥ï¼Œå¯¹äºä¸€ä¸ªå†™å…¥è¾ƒä¸ºé¢‘ç¹çš„ç³»ç»Ÿï¼Œrefresh å’Œ flush æ“ä½œç›¸å…³çš„æŒ‡æ ‡è¾ƒä¸ºé‡è¦ï¼Œmerge ç›¸å…³çš„æŒ‡æ ‡ä¹Ÿéœ€è¦å…³æ³¨ï¼ŒåŒæ—¶æ•´ä¸ªå†™å…¥çš„è€—æ—¶ï¼Œæœç´¢æ–‡æ¡£æ€»æ•°ä¹Ÿéœ€è¦å…³æ³¨ï¼Œæ•…è€Œéœ€è¦å…³æ³¨çš„å†™å…¥ç›¸å…³æŒ‡æ ‡ä¸ºï¼š

  

|åºå·|æŒ‡æ ‡|ç±»å‹|è¯¦æƒ…|
|---|---|---|---|
|1|elasticsearch_indices_indexing_index_total|counter|è¢«ç´¢å¼•çš„æ–‡æ¡£æ€»æ•°|
|2|elasticsearch_indices_indexing_index_time_seconds_total|counter|ç´¢å¼•æ–‡æ¡£èŠ±è´¹çš„æ€»æ—¶é—´|
|3|elasticsearch_indices_refresh_total|counter|ç´¢å¼•refreshçš„æ€»æ•°|
|4|elasticsearch_indices_refresh_time_seconds_total|counter|refreshç´¢å¼•æ€»å…±è¯è´¹çš„æ—¶é—´|
|5|elasticsearch_indices_flush_total|counter|flushç´¢å¼•åˆ°ç£ç›˜çš„æ€»æ•°|
|6|elasticsearch_indices_flush_time_seconds|counter|flushç´¢å¼•åˆ°ç£ç›˜çš„æ€»èŠ±è´¹æ—¶é—´|
|7|elasticsearch_indices_merges_total|counter|Total mergesï¼ˆmergeæ“ä½œæ€»æ¬¡æ•°ï¼‰|
|8|elasticsearch_indices_merges_total_time_seconds_total|counter|ç´¢å¼•mergeæ“ä½œæ€»èŠ±è´¹æ—¶é—´|
|9|elasticsearch_indices_merges_Docs_total|counter|mergeçš„æ–‡æ¡£æ€»æ•°|
|10|elasticsearch_indices_merges_total_size_bytes_total|counter|mergeçš„æ•°æ®é‡åˆè®¡|
|11|elasticsearch_indices_indexing_delete_total|counter|ç´¢å¼•çš„æ–‡ä»¶åˆ é™¤æ€»æ•°|
|12|elasticsearch_indices_indexing_delete_time_seconds_total|counter|ç´¢å¼•çš„æ–‡ä»¶åˆ é™¤æ€»æ—¶é—´|

2.3 å†…å­˜ä½¿ç”¨å’Œåƒåœ¾å›æ”¶æŒ‡æ ‡

  

ES æ˜¯ä½¿ç”¨ Java è¿›è¡Œç¼–å†™ï¼Œè¿è¡Œåœ¨ JVM ä¹‹ä¸Šï¼Œæ•…è€Œ ES ä¼šä»¥ä¸¤ç§æ–¹å¼ä½¿ç”¨èŠ‚ç‚¹ä¸Šçš„å…¨éƒ¨å¯ç”¨å†…å­˜ï¼šJVM å †å’Œæ–‡ä»¶ç³»ç»Ÿç¼“å­˜(file system cache)ï¼Œå› æ­¤ï¼Œåœ¨ ES è¿è¡ŒæœŸé—´ï¼Œæ•´ä¸ª JVM çš„åƒåœ¾å›æ”¶æŒç»­æ—¶é—´å’Œé¢‘ç‡å°†å¾ˆå€¼å¾—ç›‘æ§ã€‚

ç›¸å…³æŒ‡æ ‡ï¼š

|åºå·|æŒ‡æ ‡|ç±»å‹|è¯¦æƒ…|
|---|---|---|---|
|1|elasticsearch_jvm_gc_collection_seconds_sum|counter|JVM GCåƒåœ¾å›æ”¶æ—¶é—´|
|2|elasticsearch_jvm_gc_collection_seconds_count|counter|JVM GC åƒåœ¾æœé›†æ•°|
|3|elasticsearch_jvm_memory_committed_bytes|gauge|JVMæœ€å¤§ä½¿ç”¨å†…å­˜é™åˆ¶|
|4|elasticsearch_jvm_memory_max_bytes|gauge|é…ç½®çš„æœ€å¤§jvmå€¼|
|5|elasticsearch_jvm_memory_pool_max_bytes|counter|JVMå†…å­˜æœ€å¤§æ± æ•°|
|6|elasticsearch_jvm_memory_pool_peak_max_bytes|counter|æœ€å¤§çš„JVMå†…å­˜å³°å€¼|
|7|elasticsearch_jvm_memory_pool_peak_used_bytes|counter|æ± ä½¿ç”¨çš„JVMå†…å­˜å³°å€¼|
|8|elasticsearch_jvm_memory_pool_used_bytes|gauge|ç›®å‰ä½¿ç”¨çš„JVMå†…å­˜æ± |
|9|elasticsearch_jvm_memory_used_bytes|gauge|JVMå†…å­˜ä½¿ç”¨é‡|

2.4 ä¸»æœºçº§åˆ«ç½‘ç»œç³»ç»ŸæŒ‡æ ‡

  

ä¸»æœºçº§åˆ«èµ„æºåŠç½‘ç»œä½¿ç”¨æƒ…å†µä¹Ÿéœ€è¦å…³æ³¨ã€‚  

  

**_ç›¸å…³æŒ‡æ ‡_**

|åºå·|æŒ‡æ ‡|ç±»å‹|è¯¦æƒ…|
|---|---|---|---|
|1|elasticsearch_process_cpu_percent|gauge|CPUä½¿ç”¨ç‡|
|2|elasticsearch_filesystem_data_free_bytes|gauge|ç£ç›˜å¯ç”¨ç©ºé—´|
|3|elasticsearch_process_open_files_count|gauge|ESè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦|
|4|elasticsearch_transport_rx_packets_total|counter|ESèŠ‚ç‚¹ä¹‹é—´ç½‘ç»œå…¥æµé‡|
|5|elasticsearch_transport_tx_packets_total|counter|ESèŠ‚ç‚¹ä¹‹é—´ç½‘ç»œå‡ºæµé‡|

  

  

2.5 é›†ç¾¤å¥åº·å’ŒèŠ‚ç‚¹å¯ç”¨æ€§æŒ‡æ ‡

  

ES æ˜¯æŒ‰é›†ç¾¤éƒ¨ç½²çš„ï¼Œéœ€è¦å…³æ³¨é›†ç¾¤ç›¸å…³æŒ‡æ ‡ã€‚

### **_ç›¸å…³æŒ‡æ ‡_**

|åºå·|æŒ‡æ ‡|ç±»å‹|è¯¦æƒ…|
|---|---|---|---|
|1|elasticsearch_cluster_health_status|gauge|é›†ç¾¤çŠ¶æ€ï¼Œgreenï¼ˆ æ‰€æœ‰çš„ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½æ­£å¸¸è¿è¡Œï¼‰ã€yellowï¼ˆæ‰€æœ‰çš„ä¸»åˆ†ç‰‡éƒ½æ­£å¸¸è¿è¡Œï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„å‰¯æœ¬åˆ†ç‰‡éƒ½æ­£å¸¸è¿è¡Œï¼‰redï¼ˆæœ‰ä¸»åˆ†ç‰‡æ²¡èƒ½æ­£å¸¸è¿è¡Œï¼‰å€¼ä¸º1çš„å³ä¸ºå¯¹åº”çŠ¶æ€|
|2|elasticsearch_cluster_health_number_of_data_nodes|gauge|nodeèŠ‚ç‚¹çš„æ•°é‡|
|3|elasticsearch_cluster_health_number_of_in_flight_fetch|gauge|æ­£åœ¨è¿›è¡Œçš„ç¢ç‰‡ä¿¡æ¯è¯·æ±‚çš„æ•°é‡|
|4|elasticsearch_cluster_health_number_of_nodes|gauge|é›†ç¾¤å†…æ‰€æœ‰çš„èŠ‚ç‚¹|
|5|elasticsearch_cluster_health_number_of_pending_tasks|gauge|å°šæœªæ‰§è¡Œçš„é›†ç¾¤çº§åˆ«æ›´æ”¹|
|6|elasticsearch_cluster_health_initializing_shards|gauge|æ­£åœ¨åˆå§‹åŒ–çš„åˆ†ç‰‡æ•°|
|7|elasticsearch_cluster_health_unassigned_shards|gauge|æœªåˆ†é…åˆ†ç‰‡æ•°|
|8|elasticsearch_cluster_health_active_primary_shards|gauge|æ´»è·ƒçš„ä¸»åˆ†ç‰‡æ€»æ•°|
|9|elasticsearch_cluster_health_active_shards|gauge|æ´»è·ƒçš„åˆ†ç‰‡æ€»æ•°ï¼ˆåŒ…æ‹¬å¤åˆ¶åˆ†ç‰‡ï¼‰|
|10|elasticsearch_cluster_health_relocating_shards|gauge|å½“å‰èŠ‚ç‚¹æ­£åœ¨è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹çš„åˆ†ç‰‡æ•°é‡ï¼Œé€šå¸¸ä¸º0ï¼Œé›†ç¾¤ä¸­æœ‰èŠ‚ç‚¹æ–°åŠ å…¥æˆ–è€…é€€å‡ºæ—¶è¯¥å€¼ä¼šå¢åŠ |
|11|elasticsearch_breakers_tripped|counter|ç†”æ–­å‘ç”Ÿæ¬¡æ•°|
|12|elasticsearch_breakers_limit_size_bytes|gauge|ç†”æ–­å†…å­˜é™åˆ¶å¤§å°|
|13|elasticsearch_breakers_estimated_size_bytes|gauge|ç†”æ–­å™¨å†…å­˜å¤§å°|

2.6 èµ„æºé¥±å’Œåº¦å’Œé”™è¯¯

  

ElasticSearch èŠ‚ç‚¹ä½¿ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹å¦‚ä½•æ¶ˆè€—å†…å­˜å’Œ CPUï¼Œæ‰€ä»¥éœ€è¦ç›‘æ§çº¿ç¨‹ç›¸å…³çš„æŒ‡æ ‡ã€‚

### **_ç›¸å…³æŒ‡æ ‡_**

|åºå·|æŒ‡æ ‡|ç±»å‹|è¯¦æƒ…|
|---|---|---|---|
|1|elasticsearch_thread_pool_completed_count|gauge|çº¿ç¨‹æ± æ“ä½œå®Œæˆçº¿ç¨‹æ•°|
|2|elasticsearch_thread_pool_active_count|gauge|çº¿ç¨‹æ± æ´»è·ƒçº¿ç¨‹æ•°|
|3|elasticsearch_thread_pool_largest_count|gauge|çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°|
|4|elasticsearch_thread_pool_queue_count|gauge|çº¿ç¨‹æ± ä¸­çš„æ’é˜Ÿçº¿ç¨‹æ•°|
|5|elasticsearch_thread_pool_active_count|gauge|çº¿ç¨‹æ± çš„è¢«æ‹’ç»çº¿ç¨‹æ•°|
|6|elasticsearch_indices_fielddata_memory_size_bytes|gauge|fielddataç¼“å­˜çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰|
|7|elasticsearch_indices_fielddata_evictions|gauge|æ¥è‡ªfielddataç¼“å­˜çš„é©±é€æ¬¡æ•°|

  

**3. ç›‘æ§å¤§ç›˜**

  

Prometheus ç›‘æ§æœåŠ¡æä¾›äº†å¼€ç®±å³ç”¨çš„ Grafana ç›‘æ§å¤§ç›˜ï¼Œæ ¹æ®é¢„è®¾å¤§ç›˜å¯ä»¥ç›´æ¥ç›‘æ§ ES é›†ç¾¤å„ç±»é‡è¦æŒ‡æ ‡çŠ¶æ€ï¼Œèƒ½å¤Ÿè¿›è¡Œé—®é¢˜çš„å¿«é€Ÿå®šä½ã€‚æœ¬æ–‡é›†ç¾¤å¤§ç›˜ä½¿ç”¨äº†è…¾è®¯äº‘ ES ä½œä¸ºæ•°æ®æºï¼Œè…¾è®¯äº‘ Elasticsearch Serviceï¼ˆESï¼‰æ˜¯äº‘ç«¯å…¨æ‰˜ç®¡æµ·é‡æ•°æ®æ£€ç´¢åˆ†ææœåŠ¡ï¼Œæ‹¥æœ‰é«˜æ€§èƒ½è‡ªç ”å†…æ ¸ï¼Œé›†æˆX-Packã€‚ES æ”¯æŒé€šè¿‡è‡ªæ²»ç´¢å¼•ã€å­˜ç®—åˆ†ç¦»ã€é›†ç¾¤å·¡æ£€ç­‰ç‰¹æ€§è½»æ¾ç®¡ç†é›†ç¾¤ï¼Œä¹Ÿæ”¯æŒå…è¿ç»´ã€è‡ªåŠ¨å¼¹æ€§ã€æŒ‰éœ€ä½¿ç”¨çš„ Serverless æ¨¡å¼ã€‚ä½¿ç”¨ ES æ‚¨å¯ä»¥é«˜æ•ˆæ„å»ºä¿¡æ¯æ£€ç´¢ã€æ—¥å¿—åˆ†æã€è¿ç»´ç›‘æ§ç­‰æœåŠ¡ï¼Œå®ƒç‹¬ç‰¹çš„å‘é‡æ£€ç´¢è¿˜å¯åŠ©æ‚¨æ„å»ºåŸºäºè¯­ä¹‰ã€å›¾åƒçš„AIæ·±åº¦åº”ç”¨ã€‚

  

3.1 é›†ç¾¤å¤§ç›˜

  

é›†ç¾¤å¤§ç›˜æä¾›äº†é›†ç¾¤ç›¸å…³çš„ç›‘æ§ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº†é›†ç¾¤èŠ‚ç‚¹ã€åˆ†ç‰‡ã€èµ„æºåˆ©ç”¨ç‡ã€ç†”æ–­ã€çº¿ç¨‹æ± ç­‰ç›‘æ§ä¿¡æ¯ã€‚

### **_é›†ç¾¤æ¦‚è¦_**

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

è¯¥ç›‘æ§æä¾›é›†ç¾¤æ¦‚è§ˆä¿¡æ¯ï¼Œå¯å¤§è‡´æ¦‚è§ˆé›†ç¾¤çŠ¶å†µï¼Œå¯ä»¥çœ‹å‡ºé›†ç¾¤å¥åº·çŠ¶å†µã€èŠ‚ç‚¹æ•°ã€æ•°æ®èŠ‚ç‚¹ã€ç†”æ–­å™¨ç†”æ–­æ¬¡æ•°ã€åˆ©ç”¨ç‡ã€é›†ç¾¤ pending ä»»åŠ¡æ•°ã€ES è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ç­‰ä¿¡æ¯ã€‚é›†ç¾¤å¥åº·ç›‘æ§ red ä¸º1ï¼Œgreen æ—¶ä¸º5ï¼Œyellow ä¸º23ã€‚

### **_åˆ†ç‰‡ç›‘æ§ï¼ˆShardsï¼‰_**

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

åˆ†ç‰‡ç›‘æ§æä¾›é›†ç¾¤ä¸­çš„ä¸»èŠ‚ç‚¹æ•°ã€å‰¯æœ¬èŠ‚ç‚¹æ•°ï¼ŒåŒæ—¶æä¾›æ­£åœ¨åˆå§‹åŒ–çš„ã€æ­£åœ¨è¿ç§»çš„ã€å»¶è¿Ÿåˆ†é…çš„ã€æœªåˆ†é…çš„åˆ†ç‰‡ä¿¡æ¯ã€‚

### **_ç†”æ–­ç›‘æ§ï¼ˆBreakersï¼‰_**

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

è¯¥ç›‘æ§æä¾›å„ç±»ç†”æ–­å™¨ç†”æ–­çš„æ¬¡æ•°ï¼Œä»¥åŠç†”æ–­å†…å­˜ä½¿ç”¨é‡ã€‚å¯ä»¥é€šè¿‡è¯¥ç›‘æ§å»æ’æŸ¥ç†”æ–­å‘ç”Ÿçš„ç†”æ–­å™¨ç±»åˆ«ã€ç†”æ–­é™åˆ¶ã€ç†”æ–­å‘ç”Ÿæ—¶çš„å†…å­˜ä½¿ç”¨é‡ä»¥åŠæ˜¯å“ªä¸ªèŠ‚ç‚¹å‘ç”Ÿçš„ç†”æ–­ã€‚

  

- Tripped for breakersï¼šåˆ†æå„ç±»å‹çš„ç†”æ–­å™¨ç†”æ–­çš„æ¬¡æ•°ï¼›
    
- Estimated size in bytes of breakerï¼šåˆ†æç»™ç±»å‹ç†”æ–­å™¨ç†”æ–­å†…å­˜ä½¿ç”¨é‡ã€‚
    

### **_èŠ‚ç‚¹ç›‘æ§_**

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

- Load averageï¼šåˆ†æå„èŠ‚ç‚¹çš„çŸ­æœŸå¹³å‡è´Ÿè½½ï¼›
    
- CPU usageï¼šåˆ†æ CPU ä½¿ç”¨ç‡ï¼›
    
- GC countï¼šåˆ†æ JVM GC è¿è¡Œæ¬¡æ•°ï¼›
    
- GC timeï¼šåˆ†æ JVM GC è¿è¡Œæ—¶é—´ã€‚
    

  

èŠ‚ç‚¹ç›‘æ§æä¾›äº†å„èŠ‚ç‚¹çš„çŸ­æœŸå¹³å‡è´Ÿè½½ã€CPU ä½¿ç”¨æƒ…å†µã€JVM GC è¿è¡Œç›¸å…³æ•°æ®ã€æ•°æ®å­˜å‚¨ä½¿ç”¨æƒ…å†µã€ç½‘ç»œä½¿ç”¨æƒ…å†µç­‰ã€‚å¯ä»¥é€šè¿‡è¯¥ç›‘æ§å‘ç°å¹¶å¿«é€Ÿå®šä½èŠ‚ç‚¹èµ„æºé—®é¢˜ã€‚

  

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

- JVM memory usageï¼šåˆ†æ JVM å†…å­˜ä½¿ç”¨é‡ã€å†…å­˜æœ€å¤§é™åˆ¶ä»¥åŠæ± å†…å­˜ä½¿ç”¨å³°å€¼ï¼›
    
- JVM memory committedï¼šåˆ†æå„åŒºåŸŸæäº¤å†…å­˜ä½¿ç”¨é‡ï¼›
    
- Disk usageï¼šåˆ†ææ•°æ®å­˜å‚¨ä½¿ç”¨æƒ…å†µï¼›
    
- Network usageï¼šåˆ†æç½‘ç»œä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬å‘é€å’Œæ¥æ”¶ã€‚
    

### **_çº¿ç¨‹æ± _****_ç›‘æ§ï¼ˆThread Poolï¼‰_**

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

- Thread Pool operations rejectedï¼šåˆ†æçº¿ç¨‹æ± ä¸­å„ç±»å‹æ“ä½œæ‹’ç»ç‡ï¼›
    
- Thread Pool operations queuedï¼šåˆ†æçº¿ç¨‹æ± ä¸­å„ç±»å‹çº¿ç¨‹æ’é˜Ÿæ•°ï¼›
    
- Thread Pool threads activeï¼šåˆ†æçº¿ç¨‹æ± ä¸­å„ç±»å‹æ´»è·ƒçº¿ç¨‹æ•°ï¼›
    
- Thread Pool operations completedï¼šåˆ†æçº¿ç¨‹æ± ä¸­å„ç±»å‹çº¿ç¨‹å®Œæˆæ•°ã€‚
    
-   
    

3.2 ç´¢å¼•å¤§ç›˜

### **_Translog_**

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

è¯¥ç›‘æ§æä¾› Translog ç›¸å…³æŒ‡æ ‡

  

- Total Translog Operationsï¼šåˆ†æ Translog æ“ä½œæ€»æ•°ï¼›
    
- Total Translog size in bytesï¼šæŸ¥çœ‹ Translog å†…å­˜ä½¿ç”¨è¶‹åŠ¿ï¼Œåˆ†ææ€§èƒ½æ˜¯å¦å½±å“å†™å…¥æ€§èƒ½ã€‚
    

### **_æ–‡æ¡£ï¼ˆDocumentsï¼‰_**

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

- Documents count on nodeï¼šåˆ†æèŠ‚ç‚¹ Index æ–‡æ¡£æ•°ï¼Œçœ‹ç´¢å¼•æ˜¯å¦è¿‡å¤§ï¼›
    
- Documents indexed rateï¼šåˆ†æ Index ç´¢å¼•é€Ÿç‡ï¼›
    
- Documents deleted rateï¼šåˆ†æ Index æ–‡æ¡£åˆ é™¤é€Ÿç‡ï¼›
    
- Documents merged rateï¼šåˆ†æç´¢å¼•æ–‡æ¡£ merge é€Ÿç‡ï¼›
    
- Documents merged bytesï¼šåˆ†æ Index merge å†…å­˜å¤§å°ã€‚
    

### **_å»¶æ—¶_**

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

- Query timeï¼šåˆ†æ Index æŸ¥è¯¢è€—æ—¶ï¼›
    
- Indexing timeï¼šåˆ†æç´¢å¼•æ–‡æ¡£è€—æ—¶ï¼›
    
- Merging timeï¼šåˆ†æç´¢å¼• merge æ“ä½œè€—æ—¶ï¼›
    
- Throttle time for index storeï¼šIndex å†™å…¥é™åˆ¶æ—¶é—´ï¼Œåˆ†æ merge ä¸å†™å…¥çš„åˆç†æ€§ã€‚
    

### **_ç´¢å¼•æ“ä½œæ¬¡æ•°åŠè€—æ—¶ï¼ˆTotal Operation statsï¼‰_**

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

- Total Operations rateï¼šåˆ†æ Index ç´¢å¼•æ“ä½œé€Ÿç‡ã€æŸ¥è¯¢é€Ÿç‡ã€æŸ¥è¯¢ fetch é€Ÿç‡ï¼Œmerge é€Ÿç‡ã€refresh é€Ÿç‡ã€flush é€Ÿç‡ã€GET å­˜åœ¨çš„é€Ÿç‡ã€GET ä¸å­˜åœ¨çš„é€Ÿç‡ã€GETæ“ä½œé€Ÿç‡ã€Index åˆ é™¤é€Ÿç‡ï¼›
    
- Total Operations timeï¼šåˆ†æ Index ç´¢å¼•æ“ä½œè€—æ—¶ã€æŸ¥è¯¢è€—æ—¶ã€æŸ¥è¯¢ fetch è€—æ—¶ï¼Œmerge è€—æ—¶ã€refresh è€—æ—¶ã€flush è€—æ—¶ã€GET å­˜åœ¨çš„è€—æ—¶ã€GET ä¸å­˜åœ¨çš„è€—æ—¶ã€GETæ“ä½œè€—æ—¶ã€Index åˆ é™¤è€—æ—¶ã€‚
    

### **_çº¿ç¨‹æ± ï¼ˆThread Poolï¼‰_**

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

- Thread Pool operations rejectedï¼šåˆ†æçº¿ç¨‹æ± ä¸­å„ç±»å‹æ“ä½œæ‹’ç»ç‡ï¼›
    
- Thread Pool operations queuedï¼šåˆ†æçº¿ç¨‹æ± ä¸­å„ç±»å‹çº¿ç¨‹æ’é˜Ÿæ•°ï¼›
    
- Thread Pool threads activeï¼šåˆ†æçº¿ç¨‹æ± ä¸­å„ç±»å‹æ´»è·ƒçº¿ç¨‹æ•°ï¼›
    
- Thread Pool operations completedï¼šåˆ†æçº¿ç¨‹æ± ä¸­å„ç±»å‹çº¿ç¨‹å®Œæˆæ•°ã€‚
    

### **_ç¼“å­˜ï¼ˆCachesï¼‰_**

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

- Field data memory sizeï¼šåˆ†æ Fielddata ç¼“å­˜å¤§å°ï¼›
    
- Field data evictionsï¼šåˆ†æ Fielddata ç¼“å­˜è¾¾åˆ°é©±é€é™åˆ¶åé©±é€çš„æ•°æ®çš„é€Ÿç‡ï¼›
    
- Query cache sizeï¼šåˆ†ææŸ¥è¯¢ç¼“å­˜å¤§å°ï¼›
    
- Query cache evictionsï¼šåˆ†æ Query ç¼“å­˜è¾¾åˆ°é©±é€é™åˆ¶åé©±é€çš„æ•°æ®çš„é€Ÿç‡ï¼›
    
- Evictions from filter cacheï¼šåˆ†æè¿‡æ»¤æŸ¥è¯¢è¾¾åˆ°é©±é€é™åˆ¶åé©±é€çš„æ•°æ®çš„é€Ÿç‡ã€‚
    

### **_æ®µï¼ˆSegmentsï¼‰_**

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

- Documents count on nodeï¼šåˆ†æèŠ‚ç‚¹ä¸Šçš„ç´¢å¼• Segment è®¡æ•°ï¼›
    
- Current memory size of Segments in bytesï¼šåˆ†æå½“å‰ç´¢å¼• Segment å†…å­˜å¤§å°ã€‚
    

  

**4. å…¸å‹é—®é¢˜åœºæ™¯**

  

4.1 ElasticSearchÂ æŸ¥è¯¢æ€§èƒ½å·®

  

ElasticSearch æŸ¥è¯¢æ€§èƒ½å˜å·®çš„åŸå› æœ‰å¾ˆå¤šï¼Œéœ€è¦é€šè¿‡ç›‘æ§æŒ‡æ ‡åˆ¤æ–­å…·ä½“ç—‡çŠ¶ï¼Œç„¶åæ ¹æ®ç—‡çŠ¶è¿›è¡Œç›¸åº”å¤„ç†ã€‚

### **_éæ´»åŠ¨çŠ¶æ€ä¸‹èµ„æºåˆ©ç”¨ç‡ä¹Ÿå¾ˆé«˜_**

æ¯ä¸ªåˆ†ç‰‡éƒ½æ¶ˆè€—èµ„æºï¼ˆCPU/å†…å­˜ï¼‰ã€‚å³ä½¿æ²¡æœ‰ç´¢å¼•/æœç´¢è¯·æ±‚ï¼Œåˆ†ç‰‡çš„å­˜åœ¨ä¹Ÿä¼šäº§ç”Ÿé›†ç¾¤å¼€é”€ã€‚

  

- **åŸå› **ï¼šé›†ç¾¤ä¸­åˆ†ç‰‡å¤ªå¤šï¼Œä»¥è‡³äºä»»ä½•æŸ¥è¯¢çš„æ‰§è¡Œé€Ÿåº¦çœ‹èµ·æ¥éƒ½å¾ˆæ…¢ï¼›
    
      
    
- **æ’æŸ¥æ–¹æ³•**ï¼šæ£€æŸ¥é›†ç¾¤å¤§ç›˜ä¸­çš„åˆ†ç‰‡ç›‘æ§ï¼ŒæŸ¥çœ‹åˆ†ç‰‡æ˜¯å¦è¿‡å¤šï¼›
    
      
    
- **è§£å†³æ–¹æ¡ˆ**ï¼šå‡å°‘åˆ†ç‰‡è®¡æ•°ï¼Œå®æ–½å†»ç»“ç´¢å¼•å’Œ/æˆ–æ·»åŠ é™„åŠ èŠ‚ç‚¹æ¥å®ç°è´Ÿè½½å¹³è¡¡ã€‚è€ƒè™‘ç»“åˆä½¿ç”¨ ElasticSearch ä¸­çš„çƒ­/æ¸©æ¶æ„ï¼ˆéå¸¸é€‚åˆåŸºäºæ—¶é—´çš„ç´¢å¼•ï¼‰ä»¥åŠæ»šåŠ¨/æ”¶ç¼©åŠŸèƒ½ï¼Œä»¥é«˜æ•ˆç®¡ç†åˆ†ç‰‡è®¡æ•°ã€‚è¦æƒ³é¡ºåˆ©å®Œæˆéƒ¨ç½²ï¼Œæœ€å¥½å…ˆæ‰§è¡Œé€‚å½“çš„å®¹é‡è®¡åˆ’ï¼Œä»¥å¸®åŠ©ç¡®å®šé€‚åˆæ¯ä¸ªæœç´¢ç”¨ä¾‹çš„æœ€ä½³åˆ†ç‰‡æ•°ã€‚
    

### **_çº¿ç¨‹æ± å­˜åœ¨å¤§é‡çš„â€œrejectedâ€_**

çº¿ç¨‹æ± ä¸­å­˜åœ¨å¤§é‡æ‹’ç»ï¼Œä»è€Œå¯¼è‡´æŸ¥è¯¢ä¸èƒ½è¢«æ­£å¸¸æ‰§è¡Œã€‚

  

- **åŸå› **ï¼šæŸ¥è¯¢é¢å‘çš„åˆ†ç‰‡å¤ªå¤šï¼Œè¶…è¿‡äº†é›†ç¾¤ä¸­çš„æ ¸å¿ƒæ•°ã€‚è¿™ä¼šåœ¨æœç´¢çº¿ç¨‹æ± ä¸­é€ æˆæ’é˜Ÿä»»åŠ¡ï¼Œä»è€Œå¯¼è‡´æœç´¢æ‹’ç»ã€‚å¦ä¸€ä¸ªå¸¸è§åŸå› æ˜¯ç£ç›˜ I/O é€Ÿåº¦æ…¢ï¼Œå¯¼è‡´æœç´¢æ’é˜Ÿæˆ–åœ¨æŸäº›æƒ…å†µä¸‹ CPU å®Œå…¨é¥±å’Œï¼›
    
      
    
- **æ’æŸ¥æ–¹æ³•**ï¼šæŸ¥çœ‹é›†ç¾¤å¤§ç›˜çº¿ç¨‹æ± ç›‘æ§ä¸­çš„æ‹’ç»ç‡ç›‘æ§ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å¤§é‡æ‹’ç»ï¼›
    
      
    
- **è§£å†³æ–¹æ¡ˆ**ï¼šåˆ›å»ºç´¢å¼•æ—¶é‡‡ç”¨1ä¸ªä¸»åˆ†ç‰‡:1ä¸ªå‰¯æœ¬åˆ†ç‰‡ (1P:1R) æ¨¡å‹ã€‚ä½¿ç”¨ç´¢å¼•æ¨¡æ¿æ˜¯ä¸€ä¸ªåœ¨åˆ›å»ºç´¢å¼•æ—¶éƒ¨ç½²æ­¤è®¾ç½®çš„å¥½æ–¹æ³•ã€‚ï¼ˆElasticSearch 7.0 æˆ–æ›´é«˜ç‰ˆæœ¬å°†é»˜è®¤ 1P:1Rï¼‰ã€‚ElasticSearch 5.1 æˆ–æ›´é«˜ç‰ˆæœ¬æ”¯æŒæœç´¢ä»»åŠ¡å–æ¶ˆï¼Œè¿™å¯¹äºå–æ¶ˆä»»åŠ¡ç®¡ç† API ä¸­å‡ºç°çš„æ…¢æŸ¥è¯¢ä»»åŠ¡éå¸¸æœ‰ç”¨ã€‚
    

### **_é«˜ CPU ä½¿ç”¨ç‡å’Œç´¢å¼•å»¶è¿Ÿ_**

æŒ‡æ ‡ç›¸å…³æ€§è¡¨æ˜ï¼Œå½“é›†ç¾¤ä¸å ªé‡è´Ÿæ—¶ï¼ŒCPU ä½¿ç”¨ç‡å’Œç´¢å¼•å»¶è¿Ÿéƒ½ä¼šå¾ˆé«˜ã€‚

- **åŸå› **ï¼šé›†ç¾¤ç´¢å¼•é‡å¤§ä¼šå½±å“æœç´¢æ€§èƒ½ã€‚
    
      
    
- **æ’æŸ¥æ–¹æ³•**ï¼šæŸ¥çœ‹ç´¢å¼•å¤§ç›˜èŠ‚ç‚¹ç›‘æ§ä¸­çš„ CPU ä½¿ç”¨ç‡ã€JVM CPU ä½¿ç”¨ç‡ç›‘æ§æŸ¥çœ‹ CPU åˆ©ç”¨ç‡ï¼Œç„¶åé€šè¿‡å»¶æ—¶å‘Šè­¦ä¸­çš„ç´¢å¼•è€—æ—¶é¢æ¿æŸ¥çœ‹ç´¢å¼•å»¶è¿ŸçŠ¶å†µï¼›
    
      
    
- **è§£å†³æ–¹æ¡ˆ**ï¼šæé«˜ refresh é—´éš” index.refresh_ interval è‡³30sï¼Œé€šå¸¸æœ‰åŠ©äºæé«˜ç´¢å¼•æ€§èƒ½ã€‚è¿™å¯ä»¥ç¡®ä¿åˆ†ç‰‡ä¸å¿…å› ä¸ºæ¯1ç§’é»˜è®¤åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ®µè€Œé€ æˆå·¥ä½œè´Ÿè½½å¢å¤§ã€‚
    

### **_å‰¯æœ¬åˆ†ç‰‡å¢åŠ åå»¶è¿Ÿå¢å¤§_**

åœ¨å‰¯æœ¬åˆ†ç‰‡è®¡æ•°å¢åŠ ï¼ˆä¾‹å¦‚ï¼Œä»1å¢åŠ åˆ°2ï¼‰åï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æŸ¥è¯¢å»¶è¿Ÿã€‚å¦‚æœå­˜åœ¨è¾ƒå¤šçš„æ•°æ®ï¼Œé‚£ä¹ˆç¼“å­˜çš„æ•°æ®å°†å¾ˆå¿«è¢«é€å‡ºï¼Œä»è€Œå¯¼è‡´æ“ä½œç³»ç»Ÿé¡µé¢é”™è¯¯å¢åŠ ã€‚

  

- **åŸå› **ï¼šæ–‡ä»¶ç³»ç»Ÿç¼“å­˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜æ¥ç¼“å­˜ç´¢å¼•ä¸­ç»å¸¸æŸ¥è¯¢çš„éƒ¨åˆ†ã€‚ElasticSearch çš„æŸ¥è¯¢ç¼“å­˜å®ç°äº† LRU é€å‡ºç­–ç•¥ï¼šå½“ç¼“å­˜å˜æ»¡æ—¶ï¼Œå°†é€å‡ºæœ€è¿‘ä½¿ç”¨æœ€å°‘çš„æ•°æ®ï¼Œä»¥ä¾¿ä¸ºæ–°æ•°æ®è®©è·¯ã€‚
    
      
    
- **æ’æŸ¥æ–¹æ³•**ï¼šåœ¨åˆ†ç‰‡æœ‰å¢åŠ æ—¶ï¼ŒæŸ¥çœ‹ç´¢å¼•å¤§ç›˜å»¶æ—¶ä¸­çš„æŸ¥è¯¢è€—æ—¶ç›‘æ§ï¼Œè§‚å¯ŸæŸ¥è¯¢å»¶è¿Ÿæ˜¯å¦å¢å¤§ï¼Œè‹¥æœ‰å¢å¤§ï¼ŒæŸ¥çœ‹ç´¢å¼•å¤§ç›˜ç¼“å­˜é¢æ¿ä¸­çš„æŸ¥è¯¢ç¼“å­˜åŠæŸ¥è¯¢ç¼“å­˜é©±é€ç›‘æ§ï¼Œç¼“å­˜å˜é«˜ï¼Œé©±é€é‡å¢å¤§ï¼Œå°±æ˜¯è¯¥é—®é¢˜ï¼›
    
      
    
- **è§£å†³æ–¹æ¡ˆ**ï¼šä¸ºæ–‡ä»¶ç³»ç»Ÿç¼“å­˜ç•™å‡ºè‡³å°‘50%çš„ç‰©ç† RAMã€‚å†…å­˜è¶Šå¤šï¼Œç¼“å­˜çš„ç©ºé—´å°±è¶Šå¤§ï¼Œå°¤å…¶æ˜¯å½“é›†ç¾¤é‡åˆ° I/O é—®é¢˜æ—¶ã€‚å‡è®¾å †å¤§å°å·²æ­£ç¡®é…ç½®ï¼Œä»»ä½•å‰©ä½™çš„å¯ç”¨äºæ–‡ä»¶ç³»ç»Ÿç¼“å­˜çš„ç‰©ç† RAM éƒ½ä¼šå¤§å¤§æé«˜æœç´¢æ€§èƒ½ã€‚é™¤äº†æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼ŒElasticSearch è¿˜ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜å’Œè¯·æ±‚ç¼“å­˜æ¥æé«˜æœç´¢é€Ÿåº¦ã€‚æ‰€æœ‰è¿™äº›ç¼“å­˜éƒ½å¯ä»¥ä½¿ç”¨æœç´¢è¯·æ±‚é¦–é€‰é¡¹è¿›è¡Œä¼˜åŒ–ï¼Œä»¥ä¾¿æ¯æ¬¡éƒ½å°†æŸäº›æœç´¢è¯·æ±‚è·¯ç”±åˆ°åŒä¸€ç»„åˆ†ç‰‡ï¼Œè€Œä¸æ˜¯åœ¨ä¸åŒçš„å¯ç”¨å‰¯æœ¬ä¹‹é—´è¿›è¡Œäº¤æ›¿ã€‚è¿™å°†æ›´å¥½åœ°åˆ©ç”¨è¯·æ±‚ç¼“å­˜ã€èŠ‚ç‚¹æŸ¥è¯¢ç¼“å­˜å’Œæ–‡ä»¶ç³»ç»Ÿç¼“å­˜ã€‚
    

### **_å…±äº«èµ„æºæ—¶åˆ©ç”¨ç‡é«˜_**

æ“ä½œç³»ç»Ÿæ˜¾ç¤ºå‡ºæŒç»­çš„é«˜ CPU/ç£ç›˜ I/O åˆ©ç”¨ç‡ã€‚åœæ­¢ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºåï¼Œå¯ä»¥çœ‹åˆ°æ€§èƒ½ä¼šæé«˜ã€‚

  

- **åŸå› **ï¼šå…¶ä»–è¿›ç¨‹ï¼ˆä¾‹å¦‚ Logstashï¼‰å’Œ ElasticSearch æœ¬èº«ä¹‹é—´å­˜åœ¨èµ„æºï¼ˆCPU å’Œ/æˆ–ç£ç›˜ I/Oï¼‰äº‰ç”¨ã€‚
    
      
    
- **æ’æŸ¥æ–¹æ³•**ï¼šæŸ¥çœ‹é›†ç¾¤å¤§ç›˜èŠ‚ç‚¹ç›‘æ§é¢æ¿ä¸­çš„ CPUã€ç£ç›˜ã€ç½‘ç»œç­‰åˆ©ç”¨ç‡ç›‘æ§ï¼Œå‘ç°æŒç»­å±…é«˜ï¼Œæ­¤æ—¶åœæ­¢ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œå°±ä¼šå‘ç° CPUã€ç£ç›˜ã€ç½‘ç»œç­‰åˆ©ç”¨ç‡ä¸‹é™ï¼ŒåŒæ—¶æ€§èƒ½æé«˜ï¼›
    
      
    
- **è§£å†³æ–¹æ¡ˆ**ï¼šé¿å…åœ¨å…±äº«ç¡¬ä»¶ä¸Šä¸å…¶ä»–èµ„æºå¯†é›†å‹åº”ç”¨ç¨‹åºä¸€èµ·è¿è¡Œ ElasticSearchã€‚
    
-   
    

4.2 ElasticSearchç´¢å¼•æ€§èƒ½å·®

  

ElasticSearch ç´¢å¼•æ€§èƒ½å˜å·®çš„åŸå› åŒæ ·æœ‰å¾ˆå¤šï¼Œå…·ä½“æƒ…å†µå…·ä½“åˆ†æã€‚

### **_ç¡¬ä»¶èµ„æºä¸è¶³_**

ç¡¬ä»¶èµ„æºæ˜¯ä¸€åˆ‡çš„åŸºç¡€ï¼Œå…¶æ€§èƒ½å†³å®šç€è¿è¡Œåœ¨å…¶ä¸Šçš„é›†ç¾¤çš„æ€§èƒ½ä¸Šé™ã€‚

  

- **åŸå› **ï¼šç¡¬ç›˜é€Ÿåº¦æ…¢ã€CPU è´Ÿè½½é«˜ã€å†…å­˜ä¸è¶³ç­‰ä¼šå¯¼è‡´å†™å…¥æ€§èƒ½ä¸‹é™ï¼›
    
      
    
- **æ’æŸ¥æ–¹æ³•**ï¼šæŸ¥çœ‹é›†ç¾¤å¤§ç›˜èŠ‚ç‚¹ç›‘æ§é¢æ¿ä¸­çš„ CPUã€ç£ç›˜ã€ç½‘ç»œç­‰åˆ©ç”¨ç‡ç›‘æ§ï¼Œå„æŒ‡æ ‡æŒç»­å±…é«˜ï¼›
    
      
    
- **è§£å†³æ–¹æ¡ˆ**ï¼šå‡çº§ç¡¬ä»¶ã€å¢åŠ èŠ‚ç‚¹æˆ–è€…ä½¿ç”¨æ›´å¿«çš„å­˜å‚¨è®¾å¤‡ã€‚
    

### **_ç´¢å¼•è®¾ç½®ä¸å½“_**

ç´¢å¼•çš„åˆ†ç‰‡ã€å‰¯æœ¬æ•°åŠåˆ·æ–°æ—¶é—´é—´éš”ç­‰å‡ä¼šå½±å“ç´¢å¼•æ€§èƒ½ã€‚

  

- **åŸå› **ï¼šä¸åˆç†çš„ç´¢å¼•è®¾ç½®ï¼Œå¦‚è¿‡å¤šçš„åˆ†ç‰‡æ•°ã€ä¸åˆç†çš„å‰¯æœ¬æ•°ã€ä¸é€‚å½“çš„åˆ·æ–°é—´éš”ç­‰ä¼šå½±å“å†™å…¥æ€§èƒ½ã€‚åˆ†ç‰‡è¶Šå¤šä¼šå¯¼è‡´å†™å…¥å˜æ…¢ï¼Œå¤šå‰¯æœ¬ä¼šæå¤§çš„å½±å“å†™å…¥ååï¼Œåˆ·æ–°æ“ä½œå±äºä»£ä»·å¾ˆé«˜çš„æ“ä½œï¼Œè¿‡äºé¢‘ç¹çš„åˆ·æ–°æ“ä½œä¼šå½±å“é›†ç¾¤æ•´ä½“æ€§èƒ½ï¼›
    
      
    
- **æ’æŸ¥æ–¹æ³•**ï¼šæŸ¥çœ‹é›†ç¾¤å¤§ç›˜ä¸­çš„åˆ†ç‰‡å¤§ç›˜ï¼ŒæŸ¥çœ‹åˆ†ç‰‡æ•°ã€å‰¯æœ¬æ•°æ˜¯å¦è¿‡å¤šï¼Œåˆ¤æ–­å…¶åˆç†æ€§ï¼›
    
      
    
- **è§£å†³æ–¹æ¡ˆ**ï¼šä¼˜åŒ–ç´¢å¼•è®¾ç½®ï¼Œè°ƒæ•´åˆ†ç‰‡å’Œå‰¯æœ¬æ•°é‡ï¼Œå¢å¤§åˆ·æ–°é—´éš”ç­‰ã€‚
    

### **_ç´¢å¼•å‹åŠ›è¿‡å¤§_**

é›†ç¾¤çš„å†™å…¥èƒ½åŠ›å­˜åœ¨å…¶ä¸Šé™ï¼Œå†™å…¥é€Ÿåº¦ä¸èƒ½è¶…è¿‡ç‰¹å®šé™åˆ¶ã€‚

  

- **åŸå› **ï¼šå¤§é‡çš„å†™å…¥è¯·æ±‚è¶…è¿‡äº†é›†ç¾¤çš„å¤„ç†èƒ½åŠ›ï¼Œå¯¼è‡´å†™å…¥æ€§èƒ½ä¸‹é™ï¼›
    
      
    
- **æ’æŸ¥æ–¹æ³•**ï¼šæŸ¥çœ‹ç´¢å¼•å¤§ç›˜ä¸­çš„ Total Operations rate æŸ¥çœ‹å„ç±»å‹ç´¢å¼•æ“ä½œé€Ÿç‡ï¼Œé€šè¿‡ Total Operations time æŸ¥çœ‹å„ç±»å‹ç´¢å¼•æ“ä½œè€—æ—¶æ¥ç»¼åˆåˆ¤æ–­å†™å…¥èƒ½åŠ›æ˜¯å¦è¾¾åˆ°ä¸Šé™ï¼›
    
      
    
- **è§£å†³æ–¹æ¡ˆ**ï¼šé€šè¿‡æ°´å¹³æ‰©å±•å¢åŠ èŠ‚ç‚¹ã€ä¼˜åŒ–å†™å…¥è¯·æ±‚åˆ†å‘ç­–ç•¥ã€ä½¿ç”¨å¼‚æ­¥å†™å…¥ç­‰æ–¹å¼ç¼“è§£å†™å…¥å‹åŠ›ã€‚
    

### **_ç´¢å¼•æ•°æ®è¿‡å¤§_**

ç´¢å¼•åº”è¯¥æœ‰æ•°æ®ä¸Šé™ï¼Œè¶…è¿‡ä¸€å®šæ•°é‡å°±ä¼šå¯¼è‡´æ€§èƒ½çš„å¤§å¹…åº¦ä¸‹é™ã€‚

  

- **åŸå› **ï¼šç´¢å¼•è¿‡å¤§ä¼šå¯¼è‡´å†™å…¥æ€§èƒ½ä¸‹é™ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¡¬ç›˜ç©ºé—´ä¸è¶³çš„æƒ…å†µä¸‹ï¼›
    
      
    
- **æ’æŸ¥æ–¹æ³•**ï¼šæŸ¥çœ‹ç´¢å¼•å¤§ç›˜æ–‡æ¡£ç›‘æ§æŸ¥çœ‹æ–‡æ¡£æ€»æ•°ã€æ–‡æ¡£ç´¢å¼•é€Ÿç‡ã€æ–‡æ¡£åˆ é™¤é€Ÿç‡ã€‚è‹¥æ–‡æ¡£åˆ é™¤é€Ÿç‡ä¸º0ï¼Œåˆ™è¯´æ˜ç´¢å¼•ç”Ÿå‘½ç®¡ç†å‘¨æœŸæœ‰é—®é¢˜ï¼Œå­˜åœ¨ç”Ÿå‘½ç®¡ç†å‘¨æœŸçš„æƒ…å†µä¸‹æ–‡æ¡£æ•°å’Œç´¢å¼•é€Ÿç‡è¿˜æ˜¯å±…é«˜ï¼Œåˆ™ä¸ºè€ƒè™‘ç´¢å¼•å…¶ä»–é—®é¢˜ï¼›
    
      
    
- **è§£å†³æ–¹æ¡ˆ**ï¼šå®šæœŸå¯¹ç´¢å¼•è¿›è¡Œä¼˜åŒ–ã€ä½¿ç”¨ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠŸèƒ½ã€æˆ–è€…å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªç´¢å¼•ä¸­ã€‚
    

### **_ç´¢å¼•æ•°æ®çƒ­ç‚¹_**

å®é™…ä½¿ç”¨ä¸­ç»å¸¸ä¼šå‡ºç°ï¼ŒæŸäº›ç‰¹å®šçš„ä¸šåŠ¡ä½¿ç”¨è¾ƒå¤§ï¼Œç›¸åº”çš„ç´¢å¼•è´Ÿæ‹…å°±æ¯”è¾ƒå¤§äº†ã€‚

  

- **åŸå› **ï¼šéƒ¨åˆ†çƒ­ç‚¹æ•°æ®é›†ä¸­å†™å…¥ä¼šé€ æˆéƒ¨åˆ†èŠ‚ç‚¹è´Ÿè½½è¿‡é‡ï¼Œè€Œå…¶ä»–èŠ‚ç‚¹è´Ÿè½½è¾ƒè½»ï¼›
    
      
    
- **æ’æŸ¥æ–¹æ³•**ï¼šæŸ¥çœ‹é›†ç¾¤å¤§ç›˜ä¸­çš„èŠ‚ç‚¹ç›‘æ§ï¼ŒæŸ¥çœ‹æ˜¯å¦éƒ¨åˆ†èŠ‚ç‚¹å„ç±»è´Ÿè½½è¾ƒé«˜ï¼Œå…¶ä½™èŠ‚ç‚¹è¾ƒä½ï¼›
    
      
    
- **è§£å†³æ–¹æ¡ˆ**ï¼šé‡æ–°åˆ†ç‰‡ã€ä½¿ç”¨ç´¢å¼•åˆ«åè¿›è¡Œæ•°æ®è¿ç§»ã€æˆ–è€…è°ƒæ•´æ•°æ®å†™å…¥ç­–ç•¥ã€‚
    

### **_å…±äº«èµ„æºæ—¶åˆ©ç”¨ç‡é«˜_**

åŸå› åŠå¤„ç†åŒæŸ¥è¯¢æ€§èƒ½å˜å·®ã€‚

  

**5. ç›‘æ§ç³»ç»Ÿæ­å»º**

  

5.1 è‡ªå»º Prometheus çš„ç—›ç‚¹

## 

1. è‡ªå»ºéœ€è¦å®‰è£…å¹¶é…ç½® Prometheusã€Grafanaã€AlertManager ã€Exportor ç­‰ï¼Œè¿‡ç¨‹å¤æ‚ï¼Œå‘¨æœŸå†—é•¿ï¼›

2. é…ç½®å¤æ‚ï¼Œéœ€è¦é…ç½® Exporter å’ŒæœåŠ¡å‘ç°ç­‰æ¥ç›‘æ§ ElasticSearch é›†ç¾¤ï¼›

3. å¼€æº Grafana å¤§ç›˜ä¸å¤Ÿä¸“ä¸šï¼Œç¼ºå°‘ç»“åˆ ElasticSearch åŸç†/ç‰¹å¾å’Œæœ€ä½³å®è·µè¿›è¡Œæ·±å…¥ä¼˜åŒ–ï¼›

4. å‘Šè­¦é…ç½®å¤æ‚ï¼Œä¸”å‘Šè­¦ç³»ç»Ÿéœ€è¦è‡ªä¸»æ­å»ºï¼Œæé«˜å¤æ‚åº¦ï¼›

5. éœ€è¦å®šæœŸæ›´æ–°å’Œç»´æŠ¤ Prometheus åŠå…¶ç›¸å…³ç»„ä»¶ï¼Œä»¥ç¡®ä¿å…¶æ­£å¸¸è¿è¡Œå’Œç›‘æ§æ•ˆæœã€‚

  

5.2 è…¾è®¯äº‘ Prometheus ç›‘æ§æ¥å…¥

Prometheus ç›‘æ§æœåŠ¡æä¾›äº†åŸºäº Exporter çš„æ–¹å¼æ¥ç›‘æ§ ElasticSearch è¿è¡ŒçŠ¶æ€.

  

5.3 è‡ªå»ºä¸è…¾è®¯äº‘Prometheusç›‘æ§å¯¹æ¯”

  

  

||è‡ªå»ºPrometheus|è…¾è®¯äº‘å¯è§‚æµ‹å¹³å°  <br>Prometheusç›‘æ§|
|---|---|---|
|**æˆæœ¬**|éœ€è‡ªè¡Œé…ç½®å’Œéƒ¨ç½²PrometheusåŠç›¸å…³ç»„ä»¶ï¼Œé‡‡é›†ç»„ä»¶éœ€è¦è‡ªè¡Œæ‰©ç¼©å®¹ï¼Œè¿ç»´æˆæœ¬é«˜|å¼€ç®±å³ç”¨çš„Prometheus+Grafana+å‘Šè­¦ä¸­å¿ƒä¸€ä½“åŒ–å¹³å°ï¼Œå…¨æ‰˜ç®¡ï¼Œå…è¿ç»´|
|**æœåŠ¡å‘ç°**|è‡ªè¡Œé…ç½®ï¼Œç»´æŠ¤æˆæœ¬é«˜|å›¾å½¢ç•Œé¢å¯ç›´æ¥é€‰æ‹©éœ€è¦ä¸ŠæŠ¥çš„æŒ‡æ ‡ï¼Œå¤§å¤§é™ä½ç»´æŠ¤å¤æ‚åº¦|
|**Grafanaå¤§ç›˜**|å¼€æºå¤§ç›˜ä¿¡æ¯è¾ƒå°‘ï¼Œæ— æ³•æœ‰æ•ˆæ’æŸ¥é—®é¢˜|ä¸“ä¸šçš„ ElasticSearch ç›‘æ§å¤§ç›˜ï¼Œæ–¹ä¾¿ç”¨æˆ·å¿«é€Ÿå®šä½é—®é¢˜åŠæ€§èƒ½ä¼˜åŒ–|
|**å‘Šè­¦**|éœ€è¦ç”¨æˆ·è‡ªè¡Œéƒ¨ç½²å‘Šè­¦ç›¸å…³å†…å®¹ï¼Œä¸”é…ç½®è¾ƒä¸ºå¤æ‚|æä¾›å‘Šè­¦å¹³å°ï¼ŒåŒæ—¶æä¾›æ¸…æ™°ç•Œé¢è¿›è¡Œå‘Šè­¦é…ç½®ï¼Œç®€åŒ–æ“ä½œ|

  

  

  

  

  

![å›¾ç‰‡](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

  

  

ğŸ‘‡**ç‚¹å‡»é˜…è¯»åŸæ–‡äº†è§£ Prometheus ç›‘æ§æœåŠ¡**

é˜…è¯»åŸæ–‡

é˜…è¯»Â 6500

â€‹